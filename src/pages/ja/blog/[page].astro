---
import { getCollection } from "astro:content";
import BaseLayout from "../../../layouts/BaseLayout.astro";
import Pagination from '../../../components/Pagination.astro';
import type { GetStaticPathsOptions } from "astro";

export async function getStaticPaths({ paginate }: GetStaticPathsOptions) {
  const allPosts = await getCollection("blog", ({ id }) =>
    id.startsWith("ja/")
  );
  const sortedPosts = allPosts.sort(
    (a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
  );
  return paginate(sortedPosts, { pageSize: 10 });
}

const { page } = Astro.props;
---

<BaseLayout>
  <div class="container mx-auto px-4 py-12 max-w-4xl">
    <h1 class="text-4xl font-bold text-center mb-12">Blog</h1>
    <ul class="space-y-12">
      {
        page.data.map((post) => (
          <li>
            <a
              href={`/ja/blog/${post.slug.replace("ja/", "")}`}
              class="block group"
            >
              <div class="grid md:grid-cols-3 gap-6 items-center">
                <div class="md:col-span-1">
                  <img
                    src={post.data.img}
                    alt={post.data.img_alt ?? ""}
                    class="rounded-lg shadow-lg w-full aspect-video object-cover transition-transform group-hover:scale-105"
                  />
                </div>
                <div class="md:col-span-2">
                  <p class="text-sm text-gray-500 dark:text-gray-400">
                    <time datetime={post.data.publishDate.toISOString()}>
                      {new Date(post.data.publishDate).toLocaleDateString(
                        "ja-JP",
                        { year: "numeric", month: "long", day: "numeric" }
                      )}
                    </time>
                  </p>
                  <h2 class="text-2xl font-bold mt-2 group-hover:text-sky-600 dark:group-hover:text-sky-400 transition-colors">
                    {post.data.title}
                  </h2>
                  <p class="mt-2 text-gray-600 dark:text-gray-300">
                    {post.data.description}
                  </p>
                </div>
              </div>
            </a>
          </li>
        ))
      }
    </ul>
    <Pagination page={page} lang="ja" />
  </div>
</BaseLayout>
